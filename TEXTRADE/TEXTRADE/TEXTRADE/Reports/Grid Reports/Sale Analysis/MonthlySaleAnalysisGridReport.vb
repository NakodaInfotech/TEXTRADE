
Imports BL
Imports System.Reflection

Public Class MonthlySaleAnalysisGridReport

    Dim FILLDONE As Boolean = True

    Public Sub New()
        InitializeComponent()
        FILLCMB()
        Me.SetStyle(ControlStyles.DoubleBuffer, True)
    End Sub

    Sub FILLCMB()
        Try
            FILLNAME(CMBNAME, False, " AND GROUPMASTER.GROUP_SECONDARY = 'SUNDRY DEBTORS' AND ACC_TYPE = 'ACCOUNTS'")
            FILLNAME(CMBBROKERNAME, False, " AND GROUPMASTER.GROUP_SECONDARY = 'SUNDRY CREDITORS' AND ACC_TYPE = 'AGENT'")

            fillCITY(CMBCITY, False)
            fillregister(CMBREGISTER, " and register_type = 'SALE'")
            fillitemname(CMBITEMNAME, " AND ITEM_FRMSTRING = 'MERCHANT'")


            Dim OBJCMN As New ClsCommon
            Dim DT As DataTable = OBJCMN.SEARCH(" CAST (0 AS BIT) AS CHK, LEDGERS.Acc_cmpname AS NAME ", " ", " LEDGERS INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID LEFT OUTER JOIN STATEMASTER ON LEDGERS.ACC_STATEID = STATEMASTER.STATE_ID LEFT OUTER JOIN AREAMASTER ON LEDGERS.ACC_AREAID = AREAMASTER.AREA_ID LEFT OUTER JOIN SALESMANMASTER ON LEDGERS.ACC_SALESMANID = SALESMANMASTER.SALESMAN_ID LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON LEDGERS.ACC_AGENTID = AGENTLEDGERS.ACC_ID", " AND GROUPMASTER.GROUP_SECONDARY = 'Sundry Debtors' AND LEDGERS.ACC_YEARID = " & YearId & " ORDER BY LEDGERS.Acc_cmpname")
            gridpartydetails.DataSource = DT
            If DT.Rows.Count > 0 Then
                Gridparty.FocusedRowHandle = Gridparty.RowCount - 1
                Gridparty.TopRowIndex = Gridparty.RowCount - 15
            End If


            Dim DT1 As DataTable = OBJCMN.SEARCH(" CAST (0 AS BIT) AS CHK, LEDGERS.Acc_cmpname AS NAME", " ", " LEDGERS ", " AND LEDGERS.ACC_TYPE = 'AGENT' AND LEDGERS.ACC_YEARID = " & YearId & " ORDER BY LEDGERS.Acc_cmpname")
            GRIDAGENTDETAILS.DataSource = DT1
            If DT1.Rows.Count > 0 Then
                GRIDAGENT.FocusedRowHandle = GRIDAGENT.RowCount - 1
                GRIDAGENT.TopRowIndex = GRIDAGENT.RowCount - 15
            End If

            Dim DTITEM As DataTable = OBJCMN.SEARCH(" CAST (0 AS BIT) AS CHK, ITEMMASTER.ITEM_NAME AS NAME", " ", " ITEMMASTER ", " AND ITEMMASTER.ITEM_YEARID = " & YearId & " ORDER BY ITEMMASTER.ITEM_NAME")
            GRIDITEMDETAILS.DataSource = DTITEM
            If DTITEM.Rows.Count > 0 Then
                GRIDITEM.FocusedRowHandle = GRIDITEM.RowCount - 1
                GRIDITEM.TopRowIndex = GRIDITEM.RowCount - 15
            End If


        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub MonthlySaleAnalysisGridReport_KeyDown(sender As Object, e As KeyEventArgs) Handles Me.KeyDown
        Try
            If e.KeyCode = Windows.Forms.Keys.Escape Then
                Me.Close()
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub MonthlySaleAnalysisGridReport_Load(sender As Object, e As EventArgs) Handles Me.Load
        Try

            'DONE BY GULKIT, COZ IF FILLDONE IS NOT MENTIONED HERE THEN EVERYTIME IT GOES TO SELECTEDINDEXCHANGE EVENT ON FILLING THE COMBO
            FILLDONE = True
            CMBREPORTTYPE.SelectedIndex = 0
            CMBPRINTVALUE.SelectedIndex = 0

            dtfrom.Value = AccFrom.Date
            dtto.Value = AccTo.Date

        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Sub FILLGRID()
        Try

            Dim MONTH As Integer = 4
            If CMBPRINTVALUE.Text = "Qty And Amt" And GRIDREPORT.ColumnCount < 24 Then

                For I As Integer = 1 To 12
                    Dim COL As New DataGridViewTextBoxColumn()
                    COL.HeaderText = StrConv(MonthName(MONTH), VbStrConv.ProperCase) & " (AMT)"
                    COL.Name = UCase(MonthName(MONTH)) & "(AMT)"
                    COL.DefaultCellStyle.BackColor = Color.LightYellow
                    GRIDREPORT.Columns.Insert(GRIDREPORT.Columns("G" & UCase(MonthName(MONTH))).Index + 1, COL)
                    If MONTH = 12 Then MONTH = 0
                    MONTH += 1
                Next
                Dim COLTOTAL As New DataGridViewTextBoxColumn()
                COLTOTAL.HeaderText = "Total Amt"
                COLTOTAL.Name = "TOTALAMT"
                COLTOTAL.DefaultCellStyle.BackColor = Color.LightYellow
                GRIDREPORT.Columns.Add(COLTOTAL)

            ElseIf CMBPRINTVALUE.Text <> "Qty And Amt" And GRIDREPORT.Columns.Count > 24 Then
                'REMOVE COLUMNS
                For I As Integer = 1 To 12
                    GRIDREPORT.Columns.RemoveAt(GRIDREPORT.Columns(UCase(MonthName(MONTH)) & "(AMT)").Index)
                    If MONTH = 12 Then MONTH = 0
                    MONTH += 1
                Next
                GRIDREPORT.Columns.RemoveAt(GRIDREPORT.Columns("TOTALAMT").Index)
            End If




            If CMBSUBGROUP.Text <> "" AndAlso GRIDREPORT.ColumnCount = 14 Then
                Dim COL As New DataGridViewTextBoxColumn()
                COL.Name = UCase(CMBSUBGROUP.Text)
                COL.Width = GNAME.Width
                COL.DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft
                GRIDREPORT.Columns.Insert(GNAME.Index + 1, COL)
            ElseIf CMBSUBGROUP.Text.Trim = "" And GRIDREPORT.ColumnCount > 14 And GRIDREPORT.ColumnCount < 24 Then
                'CHECK WHETHER THE COL IS PRESENT OR NOT IF PRESENT THEN REMOVE
                GRIDREPORT.Columns.RemoveAt(GNAME.Index + 1)

            ElseIf CMBSUBGROUP.Text <> "" AndAlso GRIDREPORT.ColumnCount = 27 Then
                Dim COLSUB As New DataGridViewTextBoxColumn()
                COLSUB.Name = UCase(CMBSUBGROUP.Text)
                COLSUB.Width = GNAME.Width
                COLSUB.DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleLeft
                GRIDREPORT.Columns.Insert(GNAME.Index + 1, COLSUB)
            ElseIf CMBSUBGROUP.Text = "" AndAlso GRIDREPORT.ColumnCount > 27 Then
                'CHECK WHETHER THE COL IS PRESENT OR NOT IF PRESENT THEN REMOVE
                GRIDREPORT.Columns.RemoveAt(GNAME.Index + 1)
            End If

            If CMBSUBGROUP.Text <> "" Then GRIDREPORT.Columns(1).HeaderText = StrConv(CMBSUBGROUP.Text, VbStrConv.ProperCase)

            GRIDREPORT.RowCount = 0
            Dim WHERECLAUSE As String = " AND INVOICEMASTER.INVOICE_YEARID = " & YearId
            If chkdate.Checked = True Then WHERECLAUSE = WHERECLAUSE & " AND INVOICEMASTER.INVOICE_DATE >='" & Format(dtfrom.Value.Date, "MM/dd/yyyy") & "' AND INVOICEMASTER.INVOICE_DATE <= '" & Format(dtto.Value.Date, "MM/dd/yyyy") & "'"
            If CMBREGISTER.Text.Trim <> "" Then WHERECLAUSE = WHERECLAUSE & " AND REGISTERMASTER.REGISTER_NAME = '" & CMBREGISTER.Text.Trim & "'"
            If CMBNAME.Text.Trim <> "" Then WHERECLAUSE = WHERECLAUSE & " AND LEDGERS.ACC_CMPNAME = '" & CMBNAME.Text.Trim & "'"
            If CMBBROKERNAME.Text.Trim <> "" Then WHERECLAUSE = WHERECLAUSE & " AND AGENTLEDGERS.ACC_CMPNAME = '" & CMBBROKERNAME.Text.Trim & "'"
            If CMBITEMNAME.Text.Trim <> "" Then WHERECLAUSE = WHERECLAUSE & " AND INVDESC.ITEMNAME = '" & CMBITEMNAME.Text.Trim & "'"
            If CMBCITY.Text.Trim <> "" Then WHERECLAUSE = WHERECLAUSE & " AND CITYMASTER.CITY_NAME = '" & CMBCITY.Text.Trim & "'"


            'FOR PARTYNAME
            Dim NAMECLAUSE As String = ""
            Dim ITEMCLAUSE As String = ""
            Dim AGENTCLAUSE As String = ""

            Gridparty.ClearColumnsFilter()
            For i As Integer = 0 To Gridparty.RowCount - 1
                Dim dtrow As DataRow = Gridparty.GetDataRow(i)
                If Convert.ToBoolean(dtrow("CHK")) = True Then
                    If NAMECLAUSE = "" Then
                        NAMECLAUSE = " AND (LEDGERS.ACC_CMPNAME = '" & dtrow("NAME") & "'"
                    Else
                        NAMECLAUSE = NAMECLAUSE & " OR LEDGERS.ACC_CMPNAME = '" & dtrow("NAME") & "'"
                    End If
                End If
            Next
            If NAMECLAUSE <> "" Then
                NAMECLAUSE = NAMECLAUSE & ")"
                WHERECLAUSE = WHERECLAUSE & NAMECLAUSE
            End If


            'FOR ITEMNAME
            GRIDITEM.ClearColumnsFilter()
            For i As Integer = 0 To GRIDITEM.RowCount - 1
                Dim dtrow As DataRow = GRIDITEM.GetDataRow(i)
                If Convert.ToBoolean(dtrow("CHK")) = True Then
                    If ITEMCLAUSE = "" Then
                        ITEMCLAUSE = " AND (INVDESC.ITEMNAME = '" & dtrow("NAME") & "'"
                    Else
                        ITEMCLAUSE = ITEMCLAUSE & " OR INVDESC.ITEMNAME = '" & dtrow("NAME") & "'"
                    End If
                End If
            Next
            If ITEMCLAUSE <> "" Then
                ITEMCLAUSE = ITEMCLAUSE & ")"
                WHERECLAUSE = WHERECLAUSE & ITEMCLAUSE
            End If



            GRIDAGENT.ClearColumnsFilter()
            For i As Integer = 0 To GRIDAGENT.RowCount - 1
                Dim dtrow As DataRow = GRIDAGENT.GetDataRow(i)
                If Convert.ToBoolean(dtrow("CHK")) = True Then
                    If AGENTCLAUSE = "" Then
                        AGENTCLAUSE = " AND (AGENTLEDGERS.ACC_CMPNAME = '" & dtrow("NAME") & "'"
                    Else
                        AGENTCLAUSE = AGENTCLAUSE & " OR AGENTLEDGERS.ACC_CMPNAME = '" & dtrow("NAME") & "'"
                    End If
                End If
            Next
            If AGENTCLAUSE <> "" Then
                AGENTCLAUSE = AGENTCLAUSE & ")"
                WHERECLAUSE = WHERECLAUSE & AGENTCLAUSE
            End If



            Dim OBJCMN As New ClsCommon
            Dim DT As New DataTable

            If CMBPRINTVALUE.Text = "Qty And Amt" Then

                If CMBREPORTTYPE.Text = "PARTYWISE" Then
                    If CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT LEDGERS.Acc_cmpname AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT LEDGERS.Acc_cmpname AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT LEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT LEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT LEDGERS.Acc_cmpname AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT LEDGERS.Acc_cmpname AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT LEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT LEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL),2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT LEDGERS.Acc_cmpname AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT LEDGERS.Acc_cmpname AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT 'PARTY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'PARTY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If

                ElseIf CMBREPORTTYPE.Text = "AGENTWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(AGENTLEDGERS.Acc_cmpname,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(AGENTLEDGERS.Acc_cmpname,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(AGENTLEDGERS.Acc_cmpname,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL),2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(AGENTLEDGERS.Acc_cmpname,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT AGENTLEDGERS.Acc_cmpname AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT AGENTLEDGERS.Acc_cmpname AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT 'AGENT TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'AGENT TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'AGENT TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If

                ElseIf CMBREPORTTYPE.Text = "CITYWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL),2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT 'CITY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'CITY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'CITY TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If


                ElseIf CMBREPORTTYPE.Text = "ITEMWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT INVDESC.ITEMNAME AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.ITEMNAME AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL INVDESC.ITEMNAME AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT INVDESC.ITEMNAME AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT INVDESC.ITEMNAME AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.ITEMNAME AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.ITEMNAME AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT INVDESC.ITEMNAME AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT INVDESC.ITEMNAME AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.ITEMNAME AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT 'ITEM TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'ITEM TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'ITEM TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If


                ElseIf CMBREPORTTYPE.Text = "CATEGORYWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT INVDESC.CATEGORY AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT INVDESC.CATEGORY AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT INVDESC.CATEGORY AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL),2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", "   ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(APRILAMT,0) AS [APR (AMT)], ISNULL(MAY,0) AS MAY, ISNULL(MAYAMT,0) AS [MAY (AMT)], ISNULL(JUNE,0) AS JUN, ISNULL(JUNEAMT,0) AS [JUN (AMT)], ISNULL(JULY,0) AS JUL, ISNULL(JULYAMT,0) AS [JUL (AMT)], ISNULL(AUGUST,0) AS AUG, ISNULL(AUGUSTAMT,0) AS [AUG (AMT)], ISNULL(SEPTEMBER,0) AS SEP, ISNULL(SEPTEMBERAMT,0) AS [SEP (AMT)], ISNULL(OCTOBER,0) AS OCT, ISNULL(OCTOBERAMT,0) AS [OCT (AMT)], ISNULL(NOVEMBER,0) AS NOV, ISNULL(NOVEMBERAMT,0) AS [NOV (AMT)], ISNULL(DECEMBER,0) AS [DEC], ISNULL(DECEMBERAMT,0) AS [DEC (AMT)], ISNULL(JANUARY,0) AS JAN, ISNULL(JANUARYAMT,0) AS [JAN (AMT)], ISNULL(FEBRUARY,0) AS FEB, ISNULL(FEBRUARYAMT,0) AS [FEB (AMT)], ISNULL(MARCH,0) AS MAR, ISNULL(MARCHAMT,0) AS [MAR (AMT)], ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS , ROUND((ISNULL(APRILAMT,0) + ISNULL(MAYAMT,0)+ ISNULL(JUNEAMT,0)+ISNULL(JULYAMT,0)+ISNULL(AUGUSTAMT,0)+ISNULL(SEPTEMBERAMT,0)+ISNULL(OCTOBERAMT,0)+ISNULL(NOVEMBERAMT,0)+ISNULL(DECEMBERAMT,0)+ISNULL(JANUARYAMT,0)+ISNULL(FEBRUARYAMT,0)+ISNULL(MARCHAMT,0)),2) AS TOTALAMT ", "", " (SELECT INVDESC.CATEGORY AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , INVOICE_TOTALMTRS AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME], INVOICE_SUBTOTAL AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " UNION ALL SELECT 'CATEGORY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], ROUND(SUM(INVOICEMASTER.INVOICE_TOTALMTRS) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'CATEGORY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) + 'AMT' AS [MONTHNAME],  ROUND(SUM(INVOICEMASTER.INVOICE_SUBTOTAL) ,2) AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE)) ) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, APRILAMT, MAY, MAYAMT, JUNE, JUNEAMT, JULY, JULYAMT, AUGUST, AUGUSTAMT, SEPTEMBER, SEPTEMBERAMT, OCTOBER, OCTOBERAMT, NOVEMBER, NOVEMBERAMT, DECEMBER, DECEMBERAMT, JANUARY, JANUARYAMT, FEBRUARY, FEBRUARYAMT, MARCH, MARCHAMT)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'CATEGORY TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If
                End If
                For Each ROW As DataRow In DT.Rows
                    If CMBSUBGROUP.Text.Trim <> "" Then
                        GRIDREPORT.Rows.Add(ROW("NAME"), ROW("SUBGROUP"), Format(Val(ROW("APR")), "0.00"), Format(Val(ROW("APR (AMT)")), "0.00"), Format(Val(ROW("MAY")), "0.00"), Format(Val(ROW("MAY (AMT)")), "0.00"), Format(Val(ROW("JUN")), "0.00"), Format(Val(ROW("JUN (AMT)")), "0.00"), Format(Val(ROW("JUL")), "0.00"), Format(Val(ROW("JUL (AMT)")), "0.00"), Format(Val(ROW("AUG")), "0.00"), Format(Val(ROW("AUG (AMT)")), "0.00"), Format(Val(ROW("SEP")), "0.00"), Format(Val(ROW("SEP (AMT)")), "0.00"), Format(Val(ROW("OCT")), "0.00"), Format(Val(ROW("OCT (AMT)")), "0.00"), Format(Val(ROW("NOV")), "0.00"), Format(Val(ROW("NOV (AMT)")), "0.00"), Format(Val(ROW("DEC")), "0.00"), Format(Val(ROW("DEC (AMT)")), "0.00"), Format(Val(ROW("JAN")), "0.00"), Format(Val(ROW("JAN (AMT)")), "0.00"), Format(Val(ROW("FEB")), "0.00"), Format(Val(ROW("FEB (AMT)")), "0.00"), Format(Val(ROW("MAR")), "0.00"), Format(Val(ROW("MAR (AMT)")), "0.00"), Format(Val(ROW("TOTALMTRS")), "0.00"), Format(Val(ROW("TOTALAMT")), "0.00"))

                        'REPOVE PARTY TOTAL, AND GIVE COLORS
                        If ROW("SUBGROUP") = "PARTY TOTAL" Then
                            GRIDREPORT.Rows(GRIDREPORT.RowCount - 1).DefaultCellStyle.BackColor = Color.LightYellow
                            GRIDREPORT.Rows(GRIDREPORT.RowCount - 1).DefaultCellStyle.ForeColor = Color.Maroon
                            GRIDREPORT.Rows(GRIDREPORT.RowCount - 1).Cells(1).Value = ""
                        End If
                    Else
                        GRIDREPORT.Rows.Add(ROW("NAME"), Format(Val(ROW("APR")), "0.00"), Format(Val(ROW("APR (AMT)")), "0.00"), Format(Val(ROW("MAY")), "0.00"), Format(Val(ROW("MAY (AMT)")), "0.00"), Format(Val(ROW("JUN")), "0.00"), Format(Val(ROW("JUN (AMT)")), "0.00"), Format(Val(ROW("JUL")), "0.00"), Format(Val(ROW("JUL (AMT)")), "0.00"), Format(Val(ROW("AUG")), "0.00"), Format(Val(ROW("AUG (AMT)")), "0.00"), Format(Val(ROW("SEP")), "0.00"), Format(Val(ROW("SEP (AMT)")), "0.00"), Format(Val(ROW("OCT")), "0.00"), Format(Val(ROW("OCT (AMT)")), "0.00"), Format(Val(ROW("NOV")), "0.00"), Format(Val(ROW("NOV (AMT)")), "0.00"), Format(Val(ROW("DEC")), "0.00"), Format(Val(ROW("DEC (AMT)")), "0.00"), Format(Val(ROW("JAN")), "0.00"), Format(Val(ROW("JAN (AMT)")), "0.00"), Format(Val(ROW("FEB")), "0.00"), Format(Val(ROW("FEB (AMT)")), "0.00"), Format(Val(ROW("MAR")), "0.00"), Format(Val(ROW("MAR (AMT)")), "0.00"), Format(Val(ROW("TOTALMTRS")), "0.00"), Format(Val(ROW("TOTALAMT")), "0.00"))
                    End If
                Next

            Else

                '************* ACTUAL CODE *************** 
                'Dim GROUPBYCLAUSE As String = ""
                'Dim QTYMTRS As String = "INVOICE_TOTALMTRS"
                'If CMBPRINTVALUE.Text = "Amt Only" Then QTYMTRS = "INVOICE_SUBTOTAL"
                'If CMBPRINTVALUE.Text = "Taka Only" Then QTYMTRS = "INVOICE_TOTALPCS"
                'Dim TOTALCLAUSE As String = " ROUND(SUM(INVOICEMASTER." & QTYMTRS & ") ,2)"



                'If CMBPRINTVALUE.Text = "Avg Mtrs" Or CMBPRINTVALUE.Text = "Avg Rate" Then
                '    If CMBPRINTVALUE.Text = "Avg Mtrs" Then
                '        QTYMTRS = " CASE WHEN SUM(INVOICE_TOTALPCS) > 0 THEN ROUND((SUM(INVOICE_TOTALMTRS)/ SUM(INVOICE_TOTALPCS)),2) ELSE 0 END "
                '        TOTALCLAUSE = " CASE WHEN SUM(INVOICE_TOTALPCS) > 0 THEN ROUND((SUM(INVOICE_TOTALMTRS)/ SUM(INVOICE_TOTALPCS)),2) ELSE 0 END "
                '    ElseIf CMBPRINTVALUE.Text = "Avg Rate" Then
                '        QTYMTRS = " CASE WHEN SUM(INVOICE_TOTALMTRS) > 0 THEN ROUND((SUM(INVOICE_TOTALAMT)/ SUM(INVOICE_TOTALMTRS)),2) ELSE 0 END "
                '        TOTALCLAUSE = " CASE WHEN SUM(INVOICE_TOTALMTRS) > 0 THEN ROUND((SUM(INVOICE_TOTALAMT)/ SUM(INVOICE_TOTALMTRS)),2) ELSE 0 END "
                '    End If

                '    If CMBREPORTTYPE.Text = "PARTYWISE" Then
                '        GROUPBYCLAUSE = " GROUP BY LEDGERS.ACC_CMPNAME,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                '    ElseIf CMBREPORTTYPE.Text = "AGENTWISE" Then
                '        GROUPBYCLAUSE = " GROUP BY AGENTLEDGERS.ACC_CMPNAME,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                '    ElseIf CMBREPORTTYPE.Text = "CITYWISE" Then
                '        GROUPBYCLAUSE = " GROUP BY CITYMASTER.CITY_NAME,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                '    ElseIf CMBREPORTTYPE.Text = "ITEMWISE" Then
                '        GROUPBYCLAUSE = " GROUP BY INVDESC.ITEMNAME,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                '    ElseIf CMBREPORTTYPE.Text = "CATEGORYWISE" Then
                '        GROUPBYCLAUSE = " GROUP BY INVDESC.CATEGORY,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                '    End If
                'End If


                'If CMBREPORTTYPE.Text = "PARTYWISE" Then
                '    DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT LEDGERS.Acc_cmpname AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'PARTY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), NAME")
                'ElseIf CMBREPORTTYPE.Text = "AGENTWISE" Then
                '    DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT AGENTLEDGERS.Acc_cmpname AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'AGENT TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'AGENT TOTAL' THEN 2 ELSE 1 END), NAME")
                'ElseIf CMBREPORTTYPE.Text = "CITYWISE" Then
                '    DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] ,  " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'CITY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC  WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'CITY TOTAL' THEN 2 ELSE 1 END), NAME")
                'ElseIf CMBREPORTTYPE.Text = "ITEMWISE" Then
                '    DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.ITEMNAME AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'ITEM TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC  WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'ITEM TOTAL' THEN 2 ELSE 1 END), NAME")
                'ElseIf CMBREPORTTYPE.Text = "CATEGORYWISE" Then
                '    DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.CATEGORY AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'CATEGORY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC  WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'CATEGORY TOTAL' THEN 2 ELSE 1 END), NAME")
                'End If
                'For Each ROW As DataRow In DT.Rows
                '    GRIDREPORT.Rows.Add(ROW("NAME"), Val(ROW("APR")), Val(ROW("MAY")), Val(ROW("JUN")), Val(ROW("JUL")), Val(ROW("AUG")), Val(ROW("SEP")), Val(ROW("OCT")), Val(ROW("NOV")), Val(ROW("DEC")), Val(ROW("JAN")), Val(ROW("FEB")), Val(ROW("MAR")), Val(ROW("TOTALMTRS")))
                'Next
                '***************** END OF ACTUAL CODE *****************


                Dim GROUPBYCLAUSE As String = ""
                Dim QTYMTRS As String = "INVOICE_TOTALMTRS"
                If CMBPRINTVALUE.Text = "Amt Only" Then QTYMTRS = "INVOICE_SUBTOTAL"
                If CMBPRINTVALUE.Text = "Taka Only" Then QTYMTRS = "INVOICE_TOTALPCS"
                Dim TOTALCLAUSE As String = " ROUND(SUM(INVOICEMASTER." & QTYMTRS & ") ,2)"



                If CMBPRINTVALUE.Text = "Avg Mtrs" Or CMBPRINTVALUE.Text = "Avg Rate" Then
                    If CMBPRINTVALUE.Text = "Avg Mtrs" Then
                        QTYMTRS = " CASE WHEN SUM(INVOICE_TOTALPCS) > 0 THEN ROUND((SUM(INVOICE_TOTALMTRS)/ SUM(INVOICE_TOTALPCS)),2) ELSE 0 END "
                        TOTALCLAUSE = " CASE WHEN SUM(INVOICE_TOTALPCS) > 0 THEN ROUND((SUM(INVOICE_TOTALMTRS)/ SUM(INVOICE_TOTALPCS)),2) ELSE 0 END "
                    ElseIf CMBPRINTVALUE.Text = "Avg Rate" Then
                        QTYMTRS = " CASE WHEN SUM(INVOICE_TOTALMTRS) > 0 THEN ROUND((SUM(INVOICE_TOTALAMT)/ SUM(INVOICE_TOTALMTRS)),2) ELSE 0 END "
                        TOTALCLAUSE = " CASE WHEN SUM(INVOICE_TOTALMTRS) > 0 THEN ROUND((SUM(INVOICE_TOTALAMT)/ SUM(INVOICE_TOTALMTRS)),2) ELSE 0 END "
                    End If

                    If CMBREPORTTYPE.Text = "PARTYWISE" Then
                        If CMBSUBGROUP.Text = "AGENTWISE" Then
                            GROUPBYCLAUSE = " GROUP BY LEDGERS.ACC_CMPNAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                            GROUPBYCLAUSE = " GROUP BY LEDGERS.ACC_CMPNAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        Else
                            GROUPBYCLAUSE = " GROUP BY LEDGERS.ACC_CMPNAME,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        End If
                    ElseIf CMBREPORTTYPE.Text = "AGENTWISE" Then
                        If CMBSUBGROUP.Text = "PARTYWISE" Then
                            GROUPBYCLAUSE = " GROUP BY ISNULL(AGENTLEDGERS.ACC_CMPNAME,''), LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                            GROUPBYCLAUSE = " GROUP BY ISNULL(AGENTLEDGERS.ACC_CMPNAME,''), INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        Else
                            GROUPBYCLAUSE = " GROUP BY ISNULL(AGENTLEDGERS.ACC_CMPNAME,''),UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        End If
                    ElseIf CMBREPORTTYPE.Text = "CITYWISE" Then
                        If CMBSUBGROUP.Text = "PARTYWISE" Then
                            GROUPBYCLAUSE = " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                            GROUPBYCLAUSE = " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), ISNULL(AGENTLEDGERS.ACC_CMPNAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                            GROUPBYCLAUSE = " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        Else
                            GROUPBYCLAUSE = " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''),UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        End If
                    ElseIf CMBREPORTTYPE.Text = "ITEMWISE" Then
                        If CMBSUBGROUP.Text = "PARTYWISE" Then
                            GROUPBYCLAUSE = " GROUP BY INVDESC.ITEMNAME, LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                            GROUPBYCLAUSE = " GROUP BY INVDESC.ITEMNAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        Else
                            GROUPBYCLAUSE = " GROUP BY INVDESC.ITEMNAME,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        End If
                    ElseIf CMBREPORTTYPE.Text = "CATEGORYWISE" Then
                        If CMBSUBGROUP.Text = "PARTYWISE" Then
                            GROUPBYCLAUSE = " GROUP BY INVDESC.CATEGORY, LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                            GROUPBYCLAUSE = " GROUP BY INVDESC.CATEGORY, ISNULL(AGENTLEDGERS.ACC_CMPNAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                            GROUPBYCLAUSE = " GROUP BY INVDESC.CATEGORY, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        Else
                            GROUPBYCLAUSE = " GROUP BY INVDESC.CATEGORY,UPPER(DATENAME(MONTH,INVOICE_DATE))"
                        End If
                    End If
                End If


                If CMBREPORTTYPE.Text = "PARTYWISE" Then
                    If CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT LEDGERS.Acc_cmpname AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT LEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT LEDGERS.Acc_cmpname AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT LEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY LEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT LEDGERS.Acc_cmpname AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'PARTY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If

                ElseIf CMBREPORTTYPE.Text = "AGENTWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT AGENTLEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY AGENTLEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT AGENTLEDGERS.ACC_CMPNAME AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY AGENTLEDGERS.ACC_CMPNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(AGENTLEDGERS.Acc_cmpname,'') AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'AGENT TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'AGENT TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If

                ElseIf CMBREPORTTYPE.Text = "CITYWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY ISNULL(CITYMASTER.CITY_NAME,''), UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT ISNULL(CITYMASTER.CITY_NAME,'') AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] ,  " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'CITY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC  WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'CITY TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If

                ElseIf CMBREPORTTYPE.Text = "ITEMWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.ITEMNAME AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT INVDESC.ITEMNAME AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.ITEMNAME AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT INVDESC.ITEMNAME AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.ITEMNAME AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'ITEM TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC  WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'ITEM TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If

                ElseIf CMBREPORTTYPE.Text = "CATEGORYWISE" Then
                    If CMBSUBGROUP.Text = "PARTYWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, PARTYNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.CATEGORY AS NAME, LEDGERS.ACC_CMPNAME AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS PARTYNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE PARTYNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), PARTYNAME")
                    ElseIf CMBSUBGROUP.Text = "AGENTWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, AGENTNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.CATEGORY AS NAME, ISNULL(AGENTLEDGERS.ACC_CMPNAME,'') AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS AGENTNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE AGENTNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), AGENTNAME")
                    ElseIf CMBSUBGROUP.Text = "ITEMWISE" Then
                        DT = OBJCMN.SEARCH(" NAME, ITEMNAME AS SUBGROUP, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.CATEGORY AS NAME, INVDESC.ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT INVDESC.CATEGORY AS NAME, 'PARTY TOTAL' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY INVDESC.CATEGORY, UPPER(DATENAME(MONTH,INVOICE_DATE)) UNION ALL SELECT 'GRAND TOTAL' AS NAME, '' AS ITEMNAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'GRAND TOTAL' THEN 3 ELSE 1 END), NAME, (CASE ITEMNAME WHEN 'PARTY TOTAL' THEN 2 ELSE 1 END), ITEMNAME")
                    Else
                        DT = OBJCMN.SEARCH(" NAME, ISNULL(APRIL,0) AS APR, ISNULL(MAY,0) AS MAY, ISNULL(JUNE,0) AS JUN, ISNULL(JULY,0) AS JUL, ISNULL(AUGUST,0) AS AUG, ISNULL(SEPTEMBER,0) AS SEP, ISNULL(OCTOBER,0) AS OCT, ISNULL(NOVEMBER,0) AS NOV, ISNULL(DECEMBER,0) AS DEC, ISNULL(JANUARY,0) AS JAN, ISNULL(FEBRUARY,0) AS FEB, ISNULL(MARCH,0) AS MAR, ROUND((ISNULL(APRIL,0) + ISNULL(MAY,0)+ ISNULL(JUNE,0)+ISNULL(JULY,0)+ISNULL(AUGUST,0)+ISNULL(SEPTEMBER,0)+ISNULL(OCTOBER,0)+ISNULL(NOVEMBER,0)+ISNULL(DECEMBER,0)+ISNULL(JANUARY,0)+ISNULL(FEBRUARY,0)+ISNULL(MARCH,0)),2) AS TOTALMTRS ", "", " (SELECT INVDESC.CATEGORY AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME] , " & QTYMTRS & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC WHERE 1=1 " & WHERECLAUSE & GROUPBYCLAUSE & " UNION ALL SELECT 'CATEGORY TOTAL' AS NAME, UPPER(DATENAME(MONTH,INVOICE_DATE)) AS [MONTHNAME], " & TOTALCLAUSE & " AS TOTALMTRS FROM INVOICEMASTER INNER JOIN LEDGERS ON INVOICEMASTER.INVOICE_LEDGERID = LEDGERS.Acc_id INNER JOIN REGISTERMASTER ON INVOICEMASTER.INVOICE_REGISTERID = REGISTERMASTER.register_id INNER JOIN GROUPMASTER ON LEDGERS.Acc_groupid = GROUPMASTER.group_id LEFT OUTER JOIN LEDGERS AS AGENTLEDGERS ON INVOICEMASTER.INVOICE_AGENTID = AGENTLEDGERS.Acc_id LEFT OUTER JOIN CITYMASTER ON LEDGERS.ACC_CITYID = CITYMASTER.CITY_ID CROSS APPLY (SELECT TOP 1 ITEMMASTER.ITEM_NAME AS ITEMNAME, ISNULL(CATEGORY_NAME,'') AS CATEGORY FROM INVOICEMASTER_DESC INNER JOIN ITEMMASTER ON INVOICEMASTER_DESC.INVOICE_ITEMID = ITEMMASTER.ITEM_ID LEFT OUTER JOIN CATEGORYMASTER ON ITEMMASTER.item_categoryid = CATEGORY_ID WHERE INVOICEMASTER_DESC.INVOICE_NO = INVOICEMASTER.INVOICE_NO AND INVOICEMASTER_DESC.INVOICE_REGISTERID = INVOICEMASTER.INVOICE_REGISTERID AND INVOICEMASTER_DESC.INVOICE_YEARID = INVOICEMASTER.INVOICE_YEARID ) AS INVDESC  WHERE 1=1 " & WHERECLAUSE & " GROUP BY UPPER(DATENAME(MONTH,INVOICE_DATE))) AS INVOICEDATA PIVOT (SUM(TOTALMTRS) FOR  [MONTHNAME] IN (APRIL, MAY, JUNE, JULY, AUGUST, SEPTEMBER, OCTOBER, NOVEMBER, DECEMBER, JANUARY, FEBRUARY, MARCH)) AS PIV  ", " ORDER BY (CASE NAME WHEN 'CATEGORY TOTAL' THEN 2 ELSE 1 END), NAME")
                    End If

                End If



                For Each ROW As DataRow In DT.Rows
                    If CMBSUBGROUP.Text <> "" Then
                        GRIDREPORT.Rows.Add(ROW("NAME"), ROW("SUBGROUP"), Format(Val(ROW("APR")), "0.00"), Format(Val(ROW("MAY")), "0.00"), Format(Val(ROW("JUN")), "0.00"), Format(Val(ROW("JUL")), "0.00"), Format(Val(ROW("AUG")), "0.00"), Format(Val(ROW("SEP")), "0.00"), Format(Val(ROW("OCT")), "0.00"), Format(Val(ROW("NOV")), "0.00"), Format(Val(ROW("DEC")), "0.00"), Format(Val(ROW("JAN")), "0.00"), Format(Val(ROW("FEB")), "0.00"), Format(Val(ROW("MAR")), "0.00"), Format(Val(ROW("TOTALMTRS")), "0.00"))

                        'REPOVE PARTY TOTAL, AND GIVE COLORS
                        If ROW("SUBGROUP") = "PARTY TOTAL" Then
                            GRIDREPORT.Rows(GRIDREPORT.RowCount - 1).DefaultCellStyle.BackColor = Color.LightYellow
                            GRIDREPORT.Rows(GRIDREPORT.RowCount - 1).DefaultCellStyle.ForeColor = Color.Maroon
                            GRIDREPORT.Rows(GRIDREPORT.RowCount - 1).Cells(1).Value = ""
                        End If
                    Else
                        GRIDREPORT.Rows.Add(ROW("NAME"), Format(Val(ROW("APR")), "0.00"), Format(Val(ROW("MAY")), "0.00"), Format(Val(ROW("JUN")), "0.00"), Format(Val(ROW("JUL")), "0.00"), Format(Val(ROW("AUG")), "0.00"), Format(Val(ROW("SEP")), "0.00"), Format(Val(ROW("OCT")), "0.00"), Format(Val(ROW("NOV")), "0.00"), Format(Val(ROW("DEC")), "0.00"), Format(Val(ROW("JAN")), "0.00"), Format(Val(ROW("FEB")), "0.00"), Format(Val(ROW("MAR")), "0.00"), Format(Val(ROW("TOTALMTRS")), "0.00"))
                    End If
                Next

            End If




            If GRIDREPORT.RowCount > 1 Then

                'REMOVE DUPLICATE NAMES WHEN SUBGROUP IS PRESENT
                If CMBSUBGROUP.Text <> "" Then
                    Dim TEMPNAME As String = GRIDREPORT.Rows(0).Cells(GNAME.Index).Value
                    For I As Integer = 1 To GRIDREPORT.RowCount - 1
                        If GRIDREPORT.Rows(I).Cells(GNAME.Index).Value = TEMPNAME Then
                            GRIDREPORT.Rows(I).Cells(GNAME.Index).Value = String.Empty
                        Else
                            TEMPNAME = GRIDREPORT.Rows(I).Cells(GNAME.Index).Value.ToString
                        End If
                    Next
                End If



                GRIDREPORT.Rows(GRIDREPORT.RowCount - 1).DefaultCellStyle.ForeColor = Color.Maroon
                TabControl1.SelectedIndex = 0
            End If

        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub cmdexit_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdexit.Click
        Me.Close()
    End Sub

    Private Sub CMDSEARCH_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CMDSEARCH.Click
        Try
            If CMBREPORTTYPE.Text = CMBSUBGROUP.Text Then
                MsgBox("Invalid Report Selection", MsgBoxStyle.Critical)
                Exit Sub
            End If
            FILLGRID()
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub cmbname_Validating(ByVal sender As Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles CMBNAME.Validating
        Try
            NAMEVALIDATE(CMBNAME, CMBCODE, e, Me, txtadd, " and GROUPMASTER.GROUP_SECONDARY = 'Sundry Debtors'", "Sundry Debtors", "ACCOUNTS")
        Catch ex As Exception
            If ErrHandle(ex.Message.GetHashCode) = False Then Throw ex
        End Try

    End Sub

    Private Sub CMBAGENT_Validating(ByVal sender As System.Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles CMBBROKERNAME.Validating
        Try
            If CMBBROKERNAME.Text.Trim <> "" Then NAMEVALIDATE(CMBBROKERNAME, CMBCODE, e, Me, txtadd, " and GROUPMASTER.GROUP_SECONDARY = 'Sundry Creditors'", "Sundry Creditors", "AGENT")
        Catch ex As Exception
            If ErrHandle(ex.Message.GetHashCode) = False Then Throw ex
        End Try
    End Sub

    Private Sub CMBAGENT_KeyDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles CMBBROKERNAME.KeyDown
        Try
            If e.KeyCode = Keys.Oemcomma Then e.SuppressKeyPress = True
            If e.KeyCode = Keys.OemQuotes Then e.SuppressKeyPress = True

            If e.KeyCode = Keys.F1 Then
                Dim OBJLEDGER As New SelectLedger
                OBJLEDGER.STRSEARCH = " and GROUPMASTER.GROUP_SECONDARY = 'Sundry Creditors' AND LEDGERS.ACC_TYPE='AGENT' "
                OBJLEDGER.ShowDialog()
                'If OBJLEDGER.TEMPCODE <> "" Then CMBCODE.Text = OBJLEDGER.TEMPCODE
                If OBJLEDGER.TEMPNAME <> "" Then CMBBROKERNAME.Text = OBJLEDGER.TEMPNAME
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub CMBITEMNAME_Validating(ByVal sender As System.Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles CMBITEMNAME.Validating
        Try
            If CMBITEMNAME.Text.Trim <> "" Then itemvalidate(CMBITEMNAME, e, Me, " AND ITEMMASTER.ITEM_FRMSTRING = 'MERCHANT'", "MERCHANT")
        Catch ex As Exception
            If ErrHandle(ex.Message.GetHashCode) = False Then Throw ex
        End Try
    End Sub

    Private Sub CMBTOCITY_KeyDown(ByVal sender As System.Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles CMBCITY.KeyDown
        Try
            If e.KeyCode = Keys.Oemcomma Then e.SuppressKeyPress = True
            If e.KeyCode = Keys.OemQuotes Then e.SuppressKeyPress = True

            If e.KeyCode = Keys.F1 Then
                Dim OBJCITY As New SelectCity
                OBJCITY.FRMSTRING = "CITY"
                OBJCITY.ShowDialog()
                If OBJCITY.TEMPNAME <> "" Then CMBCITY.Text = OBJCITY.TEMPNAME
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub CMBTRANSCITY_Validating(ByVal sender As System.Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles CMBCITY.Validating
        Try
            If CMBCITY.Text.Trim <> "" Then CITYVALIDATE(CMBCITY, e, Me)
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    'Private Sub CMBBROKERNAME_SelectedValueChanged(ByVal sender As Object, ByVal e As System.EventArgs) Handles CMBNAME.SelectedValueChanged, CMBBROKERNAME.SelectedValueChanged, CMBCITY.SelectedValueChanged, CMBREGISTER.SelectedValueChanged, CMBITEMNAME.SelectedValueChanged
    '    Try
    '        If FILLDONE = False Then Exit Sub
    '        CMDSEARCH_Click(sender, e)
    '    Catch ex As Exception
    '        Throw ex
    '    End Try
    'End Sub

    Private Sub CMDCLEAR_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles CMDCLEAR.Click
        Try
            CLEAR()
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Sub CLEAR()
        Try
            CMBNAME.Text = ""
            CMBBROKERNAME.Text = ""
            CMBCITY.Text = ""
            CMBREGISTER.Text = ""
            CMBITEMNAME.Text = ""
            chkdate.CheckState = CheckState.Unchecked

            'FILLGRID()
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub CMDPRINT_Click(sender As Object, e As EventArgs) Handles CMDPRINT.Click
        Try
            If GRIDREPORT.RowCount = 0 Then Exit Sub
            Dim PRINT As Boolean = True
            Dim WHATSAPP As Boolean = True

            If MsgBox("Wish to Print?", MsgBoxStyle.YesNo) = MsgBoxResult.No Then Exit Sub

            TEMPOUTSTANDING()


            If MsgBox("Wish to Print in Excel?", MsgBoxStyle.YesNo) = MsgBoxResult.Yes Then
                Dim OBJRPT As New clsReportDesigner("Outstanding Report", System.AppDomain.CurrentDomain.BaseDirectory & "Outstanding Report.xlsx", 2)
                OBJRPT.OUTSTANDIGEXCEL(ClientName, CmpId, YearId)
                Exit Sub
            End If

            Dim OBJPL As New PLDesign
            OBJPL.frmstring = "OUTSTANDING"
            OBJPL.MdiParent = MDIMain
            OBJPL.strsearch = "{TEMPOUTSTANDING.YEARID} = " & YearId
            OBJPL.Show()
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Sub TEMPOUTSTANDING()
        Try
            'Dim OBJCMN As New ClsCommon
            'Dim DT As DataTable = OBJCMN.Execute_Any_String("DELETE FROM TEMPOUTSTANDING WHERE YEARID = " & YearId, "", "")

            'Dim I As Integer = 1

            'If TabControl1.SelectedIndex = 0 Then
            '    For Each ROW As DataGridViewRow In GRIDOUTSTANDING.Rows
            '        Dim ALPARAVAL As New ArrayList
            '        ALPARAVAL.Add(I)
            '        If ROW.Cells(GNAME.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(ROW.Cells(GNAME.Index).Value)
            '        If ROW.Cells(GINVNO.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(ROW.Cells(GINVNO.Index).Value)
            '        Dim TEMP As Date
            '        If Not DateTime.TryParse(ROW.Cells(GDATE.Index).Value, TEMP) Then
            '            ALPARAVAL.Add(DBNull.Value)
            '        Else
            '            ALPARAVAL.Add(TEMP)
            '        End If

            '        If Not DateTime.TryParse(ROW.Cells(GDUEDATE.Index).Value, TEMP) Then
            '            ALPARAVAL.Add(DBNull.Value)
            '        Else
            '            ALPARAVAL.Add(TEMP)
            '        End If

            '        If ROW.Cells(GBILLAMT.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(Val(ROW.Cells(GBILLAMT.Index).Value))

            '        'WE WILL ADD PARTYCONTACT NO IN LR NO COLUMN
            '        If ROW.Cells(GDATE.Index).Value = "CONTACT" Then
            '            If ROW.Cells(GDATE.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(ROW.Cells(GDATE.Index).Value)
            '        Else
            '            If ROW.Cells(GLRNO.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(ROW.Cells(GLRNO.Index).Value)
            '        End If

            '        If ROW.Cells(GITEMNAME.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(ROW.Cells(GITEMNAME.Index).Value)
            '        If ROW.Cells(GRECDAMT.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(Val(ROW.Cells(GRECDAMT.Index).Value))
            '        If ROW.Cells(GBALANCE.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(Val(ROW.Cells(GBALANCE.Index).Value))
            '        'If ROW.Cells(GDAYS.Index).Value = Nothing Then ALPARAVAL.Add(0) Else ALPARAVAL.Add(Val(ROW.Cells(GDAYS.Index).Value))
            '        If ROW.Cells(GOVERDUEDAYS.Index).Value = Nothing Then ALPARAVAL.Add(0) Else ALPARAVAL.Add(Val(ROW.Cells(GOVERDUEDAYS.Index).Value))
            '        If ROW.Cells(GCMPNAME.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(ROW.Cells(GCMPNAME.Index).Value)
            '        ALPARAVAL.Add(CmpId)
            '        ALPARAVAL.Add(YearId)
            '        If ROW.Cells(GCHARGES.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(Val(ROW.Cells(GCHARGES.Index).Value))

            '        Dim OBJTB As New ClsTrialBalance
            '        OBJTB.alParaval = ALPARAVAL
            '        Dim INT As Integer = OBJTB.SAVEOUTSTANDING()

            '        I += 1
            '    Next

            'Else
            '    For Each ROW As DataGridViewRow In GRIDSUMM.Rows
            '        Dim ALPARAVAL As New ArrayList
            '        ALPARAVAL.Add(I)
            '        If ROW.Cells(SNAME.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(ROW.Cells(SNAME.Index).Value)
            '        ALPARAVAL.Add("")
            '        ALPARAVAL.Add("")
            '        ALPARAVAL.Add("")
            '        ALPARAVAL.Add("")
            '        ALPARAVAL.Add("")
            '        ALPARAVAL.Add("")
            '        ALPARAVAL.Add("")
            '        If ROW.Cells(SBALANCE.Index).Value = Nothing Then ALPARAVAL.Add("") Else ALPARAVAL.Add(Val(ROW.Cells(SBALANCE.Index).Value))
            '        '  ALPARAVAL.Add(0)
            '        ALPARAVAL.Add("")
            '        ALPARAVAL.Add(CmpId)
            '        ALPARAVAL.Add(YearId)
            '        ALPARAVAL.Add("")

            '        Dim OBJTB As New ClsTrialBalance
            '        OBJTB.alParaval = ALPARAVAL
            '        Dim INT As Integer = OBJTB.SAVEOUTSTANDING()

            '        I += 1
            '    Next
            'End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub CMDWHATSAPP_Click(sender As Object, e As EventArgs) Handles CMDWHATSAPP.Click
        'Try
        '    If ALLOWWHATSAPP = False Then Exit Sub
        '    If Not CHECKWHASTAPPEXP() Then
        '        MsgBox("Whatsapp Package has Expired, Kindly contact Nakoda Infotech on 02249724411", MsgBoxStyle.Critical)
        '        Exit Sub
        '    End If

        '    If MsgBox("Send Whatsapp?", MsgBoxStyle.YesNo) = MsgBoxResult.No Then Exit Sub
        '    TEMPOUTSTANDING()
        '    Dim WHATSAPPNO As String = ""
        '    Dim OBJPL As New PLDesign
        '    OBJPL.frmstring = "OUTSTANDING"
        '    OBJPL.MdiParent = MDIMain
        '    OBJPL.strsearch = "{TEMPOUTSTANDING.YEARID} = " & YearId
        '    OBJPL.DIRECTPRINT = True
        '    OBJPL.PARTYNAME = CMBNAME.Text.Trim
        '    OBJPL.Show()
        '    OBJPL.Close()

        '    Dim OBJWHATSAPP As New SendWhatsapp
        '    OBJWHATSAPP.PARTYNAME = CMBNAME.Text.Trim
        '    OBJWHATSAPP.PATH.Add(Application.StartupPath & "\Outstanding_" & CMBNAME.Text.Trim & ".pdf")
        '    OBJWHATSAPP.FILENAME.Add("Outstanding" & PARTYNAME & ".pdf")
        '    OBJWHATSAPP.ShowDialog()
        'Catch ex As Exception
        '    Throw ex
        'End Try
    End Sub

    Private Sub GRIDREPORT_CellFormatting(sender As Object, e As DataGridViewCellFormattingEventArgs) Handles GRIDREPORT.CellFormatting
        Try
            If CMBSUBGROUP.Text = "" Then
                If e.ColumnIndex > GNAME.Index AndAlso e.Value = 0 Then
                    e.Value = String.Empty
                    e.FormattingApplied = True
                End If
            Else
                If e.ColumnIndex > GNAME.Index + 1 AndAlso e.Value = 0 Then
                    e.Value = String.Empty
                    e.FormattingApplied = True
                End If


                'If e.ColumnIndex = GNAME.Index + 1 AndAlso e.Value = "PARTY TOTAL" Then
                '    GRIDREPORT.Rows(e.RowIndex).DefaultCellStyle.ForeColor = Color.Maroon
                '    GRIDREPORT.Rows(e.RowIndex).DefaultCellStyle.BackColor = Color.LightYellow
                '    e.Value = String.Empty
                '    e.FormattingApplied = True
                'End If

            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub GRIDREPORT_SortCompare(sender As Object, e As DataGridViewSortCompareEventArgs) Handles GRIDREPORT.SortCompare
        Try
            If GRIDREPORT.ColumnCount = 14 And e.Column.Index > 0 Then
                e.SortResult = CDbl(e.CellValue1).CompareTo(CDbl(e.CellValue2))
                e.Handled = True
            End If

            If GRIDREPORT.ColumnCount = 27 And e.Column.Index > 0 Then
                e.SortResult = CDbl(e.CellValue1).CompareTo(CDbl(e.CellValue2))
                e.Handled = True
            End If

            If GRIDREPORT.ColumnCount = 15 And e.Column.Index > 1 Then
                e.SortResult = CDbl(e.CellValue1).CompareTo(CDbl(e.CellValue2))
                e.Handled = True
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub CHKSELECTITEM_CheckedChanged(sender As Object, e As EventArgs) Handles CHKSELECTITEM.CheckedChanged
        Try
            If GRIDITEMDETAILS.Visible = True Then
                For i As Integer = 0 To GRIDITEM.RowCount - 1
                    Dim dtrow As DataRow = GRIDITEM.GetDataRow(i)
                    dtrow("CHK") = CHKSELECTITEM.Checked
                Next
            End If

        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub CHKSELECTPARTY_CheckedChanged(sender As Object, e As EventArgs) Handles CHKSELECTPARTY.CheckedChanged
        Try
            If gridpartydetails.Visible = True Then
                For i As Integer = 0 To Gridparty.RowCount - 1
                    Dim dtrow As DataRow = Gridparty.GetDataRow(i)
                    dtrow("CHK") = CHKSELECTPARTY.Checked
                Next
            End If

        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub CHKSELECTAGENT_CheckedChanged(sender As Object, e As EventArgs) Handles CHKSELECTAGENT.CheckedChanged
        Try
            If GRIDAGENTDETAILS.Visible = True Then
                For i As Integer = 0 To GRIDAGENT.RowCount - 1
                    Dim dtrow As DataRow = GRIDAGENT.GetDataRow(i)
                    dtrow("CHK") = CHKSELECTAGENT.Checked
                Next
            End If

        Catch ex As Exception
            Throw ex
        End Try
    End Sub
End Class