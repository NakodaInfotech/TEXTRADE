
Imports System.Windows.Forms
Imports BL

Public Class SelectGRNforPurchase

    Public ENQname As String = ""  'for whereclause in fillgrid
    Public DT As New DataTable

    Private Sub cmdexit_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdexit.Click
        Me.Close()
    End Sub

    Private Sub SelectGRNforPurchase_KeyDown(ByVal sender As Object, ByVal e As System.Windows.Forms.KeyEventArgs) Handles Me.KeyDown
        If e.KeyCode = Windows.Forms.Keys.Escape Then
            Me.Close()
        ElseIf e.KeyCode = Keys.Enter Then
            SendKeys.Send("{Tab}")
        End If
    End Sub

    Private Sub SelectGRNforPurchase_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        Me.Top = 100
        fillgrid()
        gridbilldetails.ForceInitialize()
        gridbill.FocusedRowHandle = DevExpress.XtraGrid.GridControl.AutoFilterRowHandle
    End Sub

    Sub FILLGRID(Optional ByVal where As String = "")
        Try
            Cursor.Current = Cursors.WaitCursor
            Dim OBJCMN As New ClsCommon
            Dim DT As New DataTable
            If ClientName = "AVIS" Then
                DT = OBJCMN.search(" *, '' AS BALENO ", "", " (SELECT CAST(0 AS BIT) AS CHK, GRN.grn_no AS SRNO, GRN.grn_date AS DATE, LEDGERS.Acc_cmpname AS NAME, GRN.GRN_TYPE AS TYPE, GRN.grn_challanno AS CHALLANNO, GRN.grn_challandt AS CHALLANDATE, SUM(GRN_DESC.GRN_QTY) AS TOTALPCS, SUM(GRN_DESC.GRN_MTRS) AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GRN.grn_lrno, '') AS LRNO, ISNULL(GRN.GRN_PLOTNO, '') AS LOTNO, ISNULL(DESIGNMASTER.DESIGN_NO, '') AS DESIGNNO, ISNULL(COLORMASTER.COLOR_name, '') AS SHADE FROM GRN INNER JOIN LEDGERS ON GRN.grn_ledgerid = LEDGERS.Acc_id INNER JOIN GRN_DESC ON GRN.grn_no = GRN_DESC.GRN_NO AND GRN.GRN_TYPE = GRN_DESC.GRN_GRIDTYPE AND GRN.grn_yearid = GRN_DESC.GRN_YEARID LEFT OUTER JOIN COLORMASTER ON GRN_DESC.GRN_COLORID = COLORMASTER.COLOR_id LEFT OUTER JOIN DESIGNMASTER ON GRN_DESC.GRN_DESIGNID = DESIGNMASTER.DESIGN_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GRN.grn_transledgerid = TRANSLEDGERS.Acc_id where GRN.GRN_DONE = 0 AND GRN.GRN_TYPE <> 'Job Work' AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GRN.GRN_YEARID = " & YearId & " GROUP BY GRN.grn_no, GRN.grn_date, LEDGERS.Acc_cmpname, GRN.GRN_TYPE, GRN.grn_challanno, GRN.grn_challandt, ISNULL(TRANSLEDGERS.Acc_cmpname, ''), ISNULL(GRN.grn_lrno, ''), ISNULL(GRN.GRN_PLOTNO, ''), ISNULL(DESIGNMASTER.DESIGN_NO, ''), ISNULL(COLORMASTER.COLOR_name, '')  UNION ALL SELECT CAST(0 AS BIT) AS CHK, GREYRECTRANSPORT.GREYREC_no AS SRNO, GREYRECTRANSPORT.GREYREC_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'GREYREC' AS TYPE, GREYRECTRANSPORT.GREYREC_challanno AS CHALLANNO, GREYRECTRANSPORT.GREYREC_CHALLANDATE AS CHALLANDATE, SUM(GREYRECTRANSPORT_DESC.GREYREC_QTY) AS TOTALPCS, SUM(GREYRECTRANSPORT_DESC.GREYREC_MTRS) AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GREYRECTRANSPORT.GREYREC_lrno, '') AS LRNO, '' AS LOTNO, ISNULL(DESIGNMASTER.DESIGN_NO, '') AS DESIGNNO, ISNULL(COLORMASTER.COLOR_name, '') AS SHADE FROM GREYRECTRANSPORT INNER JOIN LEDGERS ON GREYRECTRANSPORT.GREYREC_ledgerid = LEDGERS.Acc_id INNER JOIN GREYRECTRANSPORT_DESC ON GREYRECTRANSPORT.GREYREC_no = GREYRECTRANSPORT_DESC.GREYREC_NO AND GREYRECTRANSPORT.GREYREC_yearid = GREYRECTRANSPORT_DESC.GREYREC_YEARID LEFT OUTER JOIN COLORMASTER ON GREYRECTRANSPORT_DESC.GREYREC_SHADEID = COLORMASTER.COLOR_id LEFT OUTER JOIN DESIGNMASTER ON GREYRECTRANSPORT_DESC.GREYREC_DESIGNID = DESIGNMASTER.DESIGN_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GREYRECTRANSPORT.GREYREC_TRANSID = TRANSLEDGERS.Acc_id where GREYRECTRANSPORT.GREYREC_PURDONE = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GREYRECTRANSPORT.GREYREC_YEARID = " & YearId & " GROUP BY GREYRECTRANSPORT.GREYREC_no, GREYRECTRANSPORT.GREYREC_date, LEDGERS.Acc_cmpname, GREYRECTRANSPORT.GREYREC_challanno, GREYRECTRANSPORT.GREYREC_CHALLANDATE, ISNULL(TRANSLEDGERS.Acc_cmpname, ''), ISNULL(GREYRECTRANSPORT.GREYREC_lrno, ''),  ISNULL(DESIGNMASTER.DESIGN_NO, ''), ISNULL(COLORMASTER.COLOR_name, '')  UNION ALL SELECT CAST(0 AS BIT) AS CHK, MATERIALRECEIPT.MATREC_NO AS SRNO, MATERIALRECEIPT.MATREC_DATE AS DATE, LEDGERS.Acc_cmpname AS NAME, 'MATREC' AS TYPE, MATERIALRECEIPT.MATREC_CHALLANNO AS CHALLANNO, MATERIALRECEIPT.MATREC_CHALLANDATE AS CHALLANDATE, SUM(MATERIALRECEIPT_DESC.MATREC_QTY) AS TOTALPCS, SUM(MATERIALRECEIPT_DESC.MATREC_RECDMTRS) AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(MATERIALRECEIPT.MATREC_LRNO, '') AS LRNO, ISNULL(MATERIALRECEIPT_DESC.MATREC_GRIDLOTNO, '') AS LOTNO, ISNULL(DESIGNMASTER.DESIGN_NO, '') AS DESIGNNO, ISNULL(COLORMASTER.COLOR_name, '') AS SHADE FROM MATERIALRECEIPT INNER JOIN LEDGERS ON MATERIALRECEIPT.MATREC_ledgerid = LEDGERS.Acc_id INNER JOIN MATERIALRECEIPT_DESC ON MATERIALRECEIPT.MATREC_NO = MATERIALRECEIPT_DESC.MATREC_NO AND  MATERIALRECEIPT.MATREC_yearid = MATERIALRECEIPT_DESC.MATREC_YEARID LEFT OUTER JOIN COLORMASTER ON MATERIALRECEIPT_DESC.MATREC_COLORID = COLORMASTER.COLOR_id LEFT OUTER JOIN DESIGNMASTER ON MATERIALRECEIPT_DESC.MATREC_DESIGNID = DESIGNMASTER.DESIGN_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON MATERIALRECEIPT.MATREC_TRANSID = TRANSLEDGERS.Acc_id where MaterialReceipt.MATREC_DONE = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND MATERIALRECEIPT.MATREC_YEARID = " & YearId & " GROUP BY MATERIALRECEIPT.MATREC_NO, MATERIALRECEIPT.MATREC_DATE, LEDGERS.Acc_cmpname, MATERIALRECEIPT.MATREC_CHALLANNO, MATERIALRECEIPT.MATREC_CHALLANDATE, ISNULL(TRANSLEDGERS.Acc_cmpname, ''), ISNULL(MATERIALRECEIPT.MATREC_LRNO, ''), ISNULL(MATERIALRECEIPT_DESC.MATREC_GRIDLOTNO, ''), ISNULL(DESIGNMASTER.DESIGN_NO, ''), ISNULL(COLORMASTER.COLOR_name, '') UNION ALL  SELECT        CAST(0 AS BIT) AS CHK, JOBIN.JI_no AS SRNO, JOBIN.JI_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'JOBIN' AS TYPE, JOBIN.JI_CHALLANNO AS CHALLANNO, JOBIN.JI_CHALLANDATE AS CHALLANDATE, SUM(JOBIN_DESC.JI_QTY) AS TOTALPCS, SUM(JOBIN_DESC.JI_MTRS) AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(JOBIN.JI_lrno, '') AS LRNO, ISNULL(JOBIN.JI_LOTNO, '') AS LOTNO, ISNULL(DESIGNMASTER.DESIGN_NO, '') AS DESIGNNO, ISNULL(COLORMASTER.COLOR_name, '') AS SHADE FROM JOBIN INNER JOIN LEDGERS ON JOBIN.JI_ledgerid = LEDGERS.Acc_id INNER JOIN JOBIN_DESC ON JOBIN.JI_no = JOBIN_DESC.JI_NO AND JOBIN.JI_yearid = JOBIN_DESC.JI_YEARID LEFT OUTER JOIN COLORMASTER ON JOBIN_DESC.JI_COLORID = COLORMASTER.COLOR_id LEFT OUTER JOIN DESIGNMASTER ON JOBIN_DESC.JI_DESIGNID = DESIGNMASTER.DESIGN_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON JOBIN.JI_transledgerid = TRANSLEDGERS.Acc_id where JOBIN.JI_DONE = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND JOBIN.JI_YEARID = " & YearId & " GROUP BY JOBIN.JI_no, JOBIN.JI_date, LEDGERS.Acc_cmpname, JOBIN.JI_CHALLANNO, JOBIN.JI_CHALLANDATE, ISNULL(TRANSLEDGERS.Acc_cmpname, ''), ISNULL(JOBIN.JI_lrno, ''), ISNULL(JOBIN.JI_LOTNO, ''), ISNULL(DESIGNMASTER.DESIGN_NO, ''), ISNULL(COLORMASTER.COLOR_name, '') UNION ALL SELECT CAST (0 AS BIT) AS CHK, GREYRECDKNITTING.GREY_NO AS SRNO, GREYRECDKNITTING.GREY_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'GREY' AS TYPE, GREYRECDKNITTING.GREY_challanno AS CHALLANNO, GREYRECDKNITTING.GREY_CHALLANDATE AS CHALLANDATE, GREYRECDKNITTING.GREY_TOTALQTY AS TOTALPCS, GREYRECDKNITTING.GREY_TOTALWT AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GREYRECDKNITTING.GREY_LRNO, '') AS LRNO, '' AS LOTNO, '' AS DESIGNNO, '' AS SHADE FROM  GREYRECDKNITTING INNER JOIN LEDGERS ON GREYRECDKNITTING.GREY_LEDGERID = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GREYRECDKNITTING.GREY_transledgerid = TRANSLEDGERS.Acc_id where GREYRECDKNITTING.GREY_DONE = 0 AND  LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GREYRECDKNITTING.GREY_YEARID = " & YearId & " ) AS T ", where & "  ORDER BY TYPE, SRNO")
            ElseIf ClientName = "SUPEEMA" Or ClientName = "SARAYU" Then
                'DYEINGREC WILL BE LINE WISE
                DT = OBJCMN.SEARCH(" T.*, '' AS DESIGNNO, '' AS SHADE ", "", " (SELECT CAST (0 AS BIT) AS CHK, GRN.grn_no AS SRNO, GRN.grn_date AS DATE, LEDGERS.Acc_cmpname AS NAME, GRN.GRN_TYPE AS TYPE, GRN.grn_challanno AS CHALLANNO, GRN.grn_challandt AS CHALLANDATE, GRN.GRN_TOTALQTY AS TOTALPCS, GRN.GRN_TOTALMTRS AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GRN.grn_lrno, '') AS LRNO, ISNULL(GRN.grn_PLOTNO, '') AS LOTNO, '' AS BALENO FROM GRN INNER JOIN LEDGERS ON GRN.grn_ledgerid = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GRN.grn_transledgerid = TRANSLEDGERS.Acc_id where GRN.GRN_DONE = 0  AND ISNULL(GRN.GRN_DIRECTFROMKNITTING,0) = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GRN.GRN_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, GREYRECTRANSPORT.GREYREC_no AS SRNO, GREYRECTRANSPORT.GREYREC_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'GREYREC' AS TYPE, GREYRECTRANSPORT.GREYREC_challanno AS CHALLANNO, GREYRECTRANSPORT.GREYREC_CHALLANDATE AS CHALLANDATE, GREYRECTRANSPORT.GREYREC_TOTALQTY AS TOTALPCS, GREYRECTRANSPORT.GREYREC_TOTALMTRS AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GREYRECTRANSPORT.GREYREC_lrno, '') AS LRNO,'' AS LOTNO, '' AS BALENO FROM GREYRECTRANSPORT INNER JOIN LEDGERS ON GREYRECTRANSPORT.GREYREC_ledgerid = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GREYRECTRANSPORT.GREYREC_TRANSID = TRANSLEDGERS.Acc_id where GREYRECTRANSPORT.GREYREC_PURDONE = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GREYRECTRANSPORT.GREYREC_YEARID = " & YearId & " UNION ALL SELECT  DISTINCT CAST(0 AS BIT) AS CHK, MATERIALRECEIPT.MATREC_NO AS SRNO, MATERIALRECEIPT.MATREC_DATE AS DATE, LEDGERS.Acc_cmpname AS NAME, 'MATREC' AS TYPE, MATERIALRECEIPT.MATREC_CHALLANNO AS CHALLANNO, MATERIALRECEIPT.MATREC_CHALLANDATE AS CHALLANDATE, SUM(MATERIALRECEIPT_DESC.MATREC_QTY) AS TOTALPCS, SUM(MATERIALRECEIPT_DESC.MATREC_RECDMTRS) AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(MATERIALRECEIPT.MATREC_LRNO, '') AS LRNO, ISNULL(MATERIALRECEIPT_DESC.MATREC_GRIDLOTNO, '') AS LOTNO, ISNULL(MATERIALRECEIPT_DESC.MATREC_BALENO, '') AS BALENO FROM MATERIALRECEIPT INNER JOIN LEDGERS ON MATERIALRECEIPT.MATREC_ledgerid = LEDGERS.Acc_id INNER JOIN MATERIALRECEIPT_DESC ON MATERIALRECEIPT.MATREC_NO = MATERIALRECEIPT_DESC.MATREC_NO AND MATERIALRECEIPT.MATREC_yearid = MATERIALRECEIPT_DESC.MATREC_YEARID LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON MATERIALRECEIPT.MATREC_TRANSID = TRANSLEDGERS.Acc_id WHERE (MATERIALRECEIPT_DESC.MATREC_PURDONE = 0) AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND MATERIALRECEIPT.MATREC_YEARID = " & YearId & " GROUP BY MATERIALRECEIPT.MATREC_NO, MATERIALRECEIPT.MATREC_DATE, LEDGERS.Acc_cmpname, MATERIALRECEIPT.MATREC_CHALLANNO, MATERIALRECEIPT.MATREC_CHALLANDATE, ISNULL(TRANSLEDGERS.Acc_cmpname, ''), ISNULL(MATERIALRECEIPT.MATREC_LRNO, ''), ISNULL(MATERIALRECEIPT_DESC.MATREC_GRIDLOTNO, ''), ISNULL(MATERIALRECEIPT_DESC.MATREC_BALENO, '')   UNION ALL  SELECT CAST (0 AS BIT) AS CHK, JOBIN.JI_NO AS SRNO, JOBIN.JI_DATE AS DATE, LEDGERS.Acc_cmpname AS NAME, 'JOBIN' AS TYPE, JOBIN.JI_CHALLANNO AS CHALLANNO, JOBIN.JI_CHALLANDATE AS CHALLANDATE, JOBIN.JI_TOTALQTY AS TOTALPCS, JOBIN.JI_TOTALMTRS AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(JOBIN.JI_LRNO, '') AS LRNO, ISNULL(JOBIN.JI_LOTNO,'') AS LOTNO, '' AS BALENO FROM JOBIN INNER JOIN LEDGERS ON JOBIN.JI_ledgerid = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON JOBIN.JI_transledgerid = TRANSLEDGERS.Acc_id where JOBIN.JI_DONE = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND JOBIN.JI_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, GREYRECDKNITTING.GREY_NO AS SRNO, GREYRECDKNITTING.GREY_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'GREY' AS TYPE, GREYRECDKNITTING.GREY_challanno AS CHALLANNO, GREYRECDKNITTING.GREY_CHALLANDATE AS CHALLANDATE, GREYRECDKNITTING.GREY_TOTALQTY AS TOTALPCS, GREYRECDKNITTING.GREY_TOTALWT AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GREYRECDKNITTING.GREY_LRNO, '') AS LRNO, '' AS LOTNO, '' AS BALENO FROM  GREYRECDKNITTING INNER JOIN LEDGERS ON GREYRECDKNITTING.GREY_LEDGERID = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GREYRECDKNITTING.GREY_transledgerid = TRANSLEDGERS.Acc_id where GREYRECDKNITTING.GREY_DONE = 0 AND  LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GREYRECDKNITTING.GREY_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, YARNRECD.YARN_NO AS SRNO, YARNRECD.YARN_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'YARNRECD' AS TYPE, YARNRECD.YARN_challanno AS CHALLANNO, YARNRECD.YARN_challandt AS CHALLANDATE, YARNRECD.YARN_TOTALQTY AS TOTALPCS, YARNRECD.YARN_TOTALWT AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, '' AS LRNO, ISNULL(YARNRECD.YARN_PLOTNO,'') AS LOTNO, '' AS BALENO FROM  YARNRECD INNER JOIN LEDGERS ON YARNRECD.YARN_LEDGERID = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON YARNRECD.YARN_transledgerid = TRANSLEDGERS.Acc_id where YARNRECD.YARN_DONE = 0 AND  LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND YARNRECD.YARN_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, YARNRECDJOBBER.YARN_NO AS SRNO, YARNRECDJOBBER.YARN_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'YARNRECDJOBBER' AS TYPE, YARNRECDJOBBER.YARN_challanno AS CHALLANNO, YARNRECDJOBBER.YARN_challandt AS CHALLANDATE, YARNRECDJOBBER.YARN_TOTALQTY AS TOTALPCS, YARNRECDJOBBER.YARN_TOTALWT AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, '' AS LRNO, '' AS LOTNO, '' AS BALENO FROM  YARNRECDJOBBER INNER JOIN LEDGERS ON YARNRECDJOBBER.YARN_TOLEDGERID = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON YARNRECDJOBBER.YARN_transledgerid = TRANSLEDGERS.Acc_id where YARNRECDJOBBER.YARN_DONE = 0 AND  LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND YARNRECDJOBBER.YARN_YEARID = " & YearId & ") AS T ", where & "  ORDER BY TYPE, SRNO")
            Else
                DT = OBJCMN.SEARCH(" T.*, '' AS DESIGNNO, '' AS SHADE, '' AS BALENO ", "", " (SELECT CAST (0 AS BIT) AS CHK, GRN.grn_no AS SRNO, GRN.grn_date AS DATE, LEDGERS.Acc_cmpname AS NAME, GRN.GRN_TYPE AS TYPE, GRN.grn_challanno AS CHALLANNO, GRN.grn_challandt AS CHALLANDATE, GRN.GRN_TOTALQTY AS TOTALPCS, GRN.GRN_TOTALMTRS AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GRN.grn_lrno, '') AS LRNO, ISNULL(GRN.grn_PLOTNO, '') AS LOTNO FROM GRN INNER JOIN LEDGERS ON GRN.grn_ledgerid = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GRN.grn_transledgerid = TRANSLEDGERS.Acc_id where GRN.GRN_DONE = 0 AND ISNULL(GRN.GRN_DIRECTFROMKNITTING,0) = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GRN.GRN_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, GREYRECTRANSPORT.GREYREC_no AS SRNO, GREYRECTRANSPORT.GREYREC_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'GREYREC' AS TYPE, GREYRECTRANSPORT.GREYREC_challanno AS CHALLANNO, GREYRECTRANSPORT.GREYREC_CHALLANDATE AS CHALLANDATE, GREYRECTRANSPORT.GREYREC_TOTALQTY AS TOTALPCS, GREYRECTRANSPORT.GREYREC_TOTALMTRS AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GREYRECTRANSPORT.GREYREC_lrno, '') AS LRNO,'' AS LOTNO FROM GREYRECTRANSPORT INNER JOIN LEDGERS ON GREYRECTRANSPORT.GREYREC_ledgerid = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GREYRECTRANSPORT.GREYREC_TRANSID = TRANSLEDGERS.Acc_id where GREYRECTRANSPORT.GREYREC_PURDONE = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GREYRECTRANSPORT.GREYREC_YEARID = " & YearId & " UNION ALL SELECT  DISTINCT CAST(0 AS BIT) AS CHK, MATERIALRECEIPT.MATREC_NO AS SRNO, MATERIALRECEIPT.MATREC_DATE AS DATE, LEDGERS.Acc_cmpname AS NAME, 'MATREC' AS TYPE, MATERIALRECEIPT.MATREC_CHALLANNO AS CHALLANNO, MATERIALRECEIPT.MATREC_CHALLANDATE AS CHALLANDATE, SUM(MATERIALRECEIPT_DESC.MATREC_QTY) AS TOTALPCS, SUM(MATERIALRECEIPT_DESC.MATREC_RECDMTRS) AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(MATERIALRECEIPT.MATREC_LRNO, '') AS LRNO, ISNULL(MATERIALRECEIPT_DESC.MATREC_GRIDLOTNO, '') AS LOTNO FROM MATERIALRECEIPT INNER JOIN LEDGERS ON MATERIALRECEIPT.MATREC_ledgerid = LEDGERS.Acc_id INNER JOIN MATERIALRECEIPT_DESC ON MATERIALRECEIPT.MATREC_NO = MATERIALRECEIPT_DESC.MATREC_NO AND MATERIALRECEIPT.MATREC_yearid = MATERIALRECEIPT_DESC.MATREC_YEARID LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON MATERIALRECEIPT.MATREC_TRANSID = TRANSLEDGERS.Acc_id WHERE (MATERIALRECEIPT.MATREC_DONE = 0) AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND MATERIALRECEIPT.MATREC_YEARID = " & YearId & " GROUP BY MATERIALRECEIPT.MATREC_NO, MATERIALRECEIPT.MATREC_DATE, LEDGERS.Acc_cmpname, MATERIALRECEIPT.MATREC_CHALLANNO, MATERIALRECEIPT.MATREC_CHALLANDATE, ISNULL(TRANSLEDGERS.Acc_cmpname, ''), ISNULL(MATERIALRECEIPT.MATREC_LRNO, ''), ISNULL(MATERIALRECEIPT_DESC.MATREC_GRIDLOTNO, '')   UNION ALL  SELECT CAST (0 AS BIT) AS CHK, JOBIN.JI_NO AS SRNO, JOBIN.JI_DATE AS DATE, LEDGERS.Acc_cmpname AS NAME, 'JOBIN' AS TYPE, JOBIN.JI_CHALLANNO AS CHALLANNO, JOBIN.JI_CHALLANDATE AS CHALLANDATE, JOBIN.JI_TOTALQTY AS TOTALPCS, JOBIN.JI_TOTALMTRS AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(JOBIN.JI_LRNO, '') AS LRNO, ISNULL(JOBIN.JI_LOTNO,'') AS LOTNO FROM JOBIN INNER JOIN LEDGERS ON JOBIN.JI_ledgerid = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON JOBIN.JI_transledgerid = TRANSLEDGERS.Acc_id where JOBIN.JI_DONE = 0 AND LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND JOBIN.JI_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, GREYRECDKNITTING.GREY_NO AS SRNO, GREYRECDKNITTING.GREY_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'GREY' AS TYPE, GREYRECDKNITTING.GREY_challanno AS CHALLANNO, GREYRECDKNITTING.GREY_CHALLANDATE AS CHALLANDATE, GREYRECDKNITTING.GREY_TOTALQTY AS TOTALPCS, GREYRECDKNITTING.GREY_TOTALWT AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, ISNULL(GREYRECDKNITTING.GREY_LRNO, '') AS LRNO, '' AS LOTNO FROM  GREYRECDKNITTING INNER JOIN LEDGERS ON GREYRECDKNITTING.GREY_LEDGERID = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON GREYRECDKNITTING.GREY_transledgerid = TRANSLEDGERS.Acc_id where GREYRECDKNITTING.GREY_DONE = 0 AND  LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND GREYRECDKNITTING.GREY_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, YARNRECD.YARN_NO AS SRNO, YARNRECD.YARN_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'YARNRECD' AS TYPE, YARNRECD.YARN_challanno AS CHALLANNO, YARNRECD.YARN_challandt AS CHALLANDATE, YARNRECD.YARN_TOTALQTY AS TOTALPCS, YARNRECD.YARN_TOTALWT AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, '' AS LRNO, ISNULL(YARNRECD.YARN_PLOTNO,'') AS LOTNO FROM  YARNRECD INNER JOIN LEDGERS ON YARNRECD.YARN_LEDGERID = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON YARNRECD.YARN_transledgerid = TRANSLEDGERS.Acc_id where YARNRECD.YARN_DONE = 0 AND  LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND YARNRECD.YARN_YEARID = " & YearId & " UNION ALL SELECT CAST (0 AS BIT) AS CHK, YARNRECDJOBBER.YARN_NO AS SRNO, YARNRECDJOBBER.YARN_date AS DATE, LEDGERS.Acc_cmpname AS NAME, 'YARNRECDJOBBER' AS TYPE, YARNRECDJOBBER.YARN_challanno AS CHALLANNO, YARNRECDJOBBER.YARN_challandt AS CHALLANDATE, YARNRECDJOBBER.YARN_TOTALQTY AS TOTALPCS, YARNRECDJOBBER.YARN_TOTALWT AS TOTALMTRS, ISNULL(TRANSLEDGERS.Acc_cmpname, '') AS TRANSNAME, '' AS LRNO, '' AS LOTNO FROM  YARNRECDJOBBER INNER JOIN LEDGERS ON YARNRECDJOBBER.YARN_TOLEDGERID = LEDGERS.Acc_id LEFT OUTER JOIN LEDGERS AS TRANSLEDGERS ON YARNRECDJOBBER.YARN_transledgerid = TRANSLEDGERS.Acc_id where YARNRECDJOBBER.YARN_DONE = 0 AND  LEDGERS.ACC_CMPNAME = '" & ENQname & "' AND YARNRECDJOBBER.YARN_YEARID = " & YearId & ") AS T ", where & "  ORDER BY TYPE, SRNO")
            End If
            gridbilldetails.DataSource = DT
            If DT.Rows.Count > 0 Then
                gridbill.FocusedRowHandle = gridbill.RowCount - 1
                gridbill.TopRowIndex = gridbill.RowCount - 15
            End If

        Catch ex As Exception
            If ErrHandle(ex.Message.GetHashCode) = False Then Throw ex
        Finally
            Cursor.Current = Cursors.Default
        End Try
    End Sub

    Private Sub cmdok_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles cmdok.Click
        Try
            Cursor.Current = Cursors.WaitCursor
            Dim OBJCMN As New ClsCommon

            DT.Columns.Add("SRNO")
            DT.Columns.Add("TYPE")
            DT.Columns.Add("BALENO")

            For i As Integer = 0 To gridbill.RowCount - 1
                Dim dtrow As DataRow = gridbill.GetDataRow(i)
                If Convert.ToBoolean(dtrow("CHK")) = True Then
                    DT.Rows.Add(dtrow("SRNO"), dtrow("TYPE"), dtrow("BALENO"))
                End If
            Next

            Me.Close()
        Catch ex As Exception
            If ErrHandle(ex.Message.GetHashCode) = False Then Throw ex
        Finally
            Cursor.Current = Cursors.WaitCursor
        End Try
    End Sub

    Private Sub CHKALL_CheckedChanged(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles chkall.CheckedChanged
        Try
            For i As Integer = 0 To gridbill.RowCount - 1
                Dim dtrow As DataRow = gridbill.GetDataRow(i)
                dtrow("CHK") = CHKALL.Checked
            Next
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Private Sub SelectGRNforPurchase_Shown(sender As Object, e As EventArgs) Handles Me.Shown
        Try
            If ClientName <> "AVIS" Then
                GDESIGNNO.Visible = False
                GSHADE.Visible = False
            End If

            If ClientName <> "SUPEEMA" And ClientName <> "SARAYU" Then
                GBALENO.Visible = False
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub
End Class